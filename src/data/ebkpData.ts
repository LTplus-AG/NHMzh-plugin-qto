// Defines the structure for each item in the ebkpData array
export interface EbkpDataItem {
  code: string;
  name: string;
  // Add other fields if necessary, e.g., description, level
}

// Helper function to normalize EBKP codes (ensure leading zeros)
export const normalizeEbkpCode = (code: string): string => {
  // Accept lower/upper case: C2.3, c2.3, C02.03, c02.03 → C02.03
  const match = code.trim().toUpperCase().match(/^([A-Ja-j])(\d{1,2})\.(\d{1,2})$/);
  if (match) {
    const [, letter, group, element] = match;
    // Pad with leading zeros to ensure 2 digits
    const paddedGroup = group.padStart(2, '0');
    const paddedElement = element.padStart(2, '0');
    return `${letter}${paddedGroup}.${paddedElement}`;
  }
  return code; // Return original if it doesn't match the pattern
};

// Prebuilt Map for faster lookups (lazy to avoid TDZ with ebkpData)
let _ebkpMap: Map<string, string> | null = null;
const getEbkpMap = (): Map<string, string> => {
  if (!_ebkpMap) {
    _ebkpMap = new Map(ebkpData.map((i) => [normalizeEbkpCode(i.code), i.name]));
  }
  return _ebkpMap;
};

// Function to infer classification name from code
export const getEbkpNameFromCode = (code: string | null | undefined): string | null => {
  if (!code) return null;

  const normalized = normalizeEbkpCode(code);
  const direct = getEbkpMap().get(normalized);
  if (direct) return direct;

  // parent fallback: CAA.BB.CC -> CAA.BB
  const parent = normalized.replace(/^([A-J]\d{2}\.\d{2})\.\d{2}$/, "$1");
  return getEbkpMap().get(parent) ?? null;
};

// Function to check if a code is a valid eBKP code
export const isValidEbkpCode = (code: string | null | undefined): boolean => {
  if (!code) return false;
  const normalized = normalizeEbkpCode(code);
  if (getEbkpMap().has(normalized)) return true;
  const parent = normalized.replace(/^([A-J]\d{2}\.\d{2})\.\d{2}$/, "$1");
  return getEbkpMap().has(parent);
};

export const ebkpData: EbkpDataItem[] = [
  /*   { code: "A01.01", name: "Grundstückserwerb" },
    { code: "A01.02", name: "Baurechtserwerb" },
    { code: "A01.03", name: "Bauwerkserwerb" },
    { code: "A01.04", name: "Perimeterbeitrag" },
    { code: "A02.01", name: "Handänderungssteuer, Gewinnsteuer" },
    { code: "A02.02", name: "Notariatskosten" },
    { code: "A02.03", name: "Grundbuchgebühr" },
    { code: "A02.04", name: "Anwaltskosten, Gerichtskosten" },
    { code: "A02.05", name: "Vermittlungsprovision" },
    { code: "A02.06", name: "Abfindung, Servitut" },
    { code: "A02.07", name: "Vermessung, Vermarkung" },
    { code: "B01.01", name: "Baugrunduntersuchung" },
    { code: "B01.02", name: "Bestandsaufnahme" },
    { code: "B01.03", name: "Umweltmessung" },
    { code: "B01.04", name: "Überwachung" },
    { code: "B02.01", name: "Baustellenerschliessung" },
    { code: "B02.02", name: "Versorgung, Entsorgung" },
    { code: "B02.03", name: "Arbeitsraum, Aufenthaltsraum" },
    { code: "B02.04", name: "Hebe-,  Verlade-,  Transport-,  Lagereinrichtung" },
    { code: "B02.05", name: "Einrichtung für Materialaufbereitung" },
    { code: "B02.06", name: "Witterungsbedingte Baumassnahme" },
    { code: "B02.07", name: "Baustellenorganisation, Sicherheit" },
    { code: "B02.08", name: "Schutzmassnahme für Umgebung" },
    { code: "B03.01", name: "Provisorisches Rückhaltesystem" },
    { code: "B03.02", name: "Provisorische Werkleitung" },
    { code: "B03.03", name: "Provisorisches Gebäude" },
    { code: "B03.04", name: "Provisorische Verkehrsanlage" },
    { code: "B03.05", name: "Provisorische Ausstattung" },
    { code: "B04.01", name: "Starkstromleitung" },
    { code: "B04.02", name: "Schwachstromleitung" },
    { code: "B04.03", name: "Fernwärmeleitung" },
    { code: "B04.04", name: "Fernkälteleitung" },
    { code: "B04.05", name: "Wasserleitung" },
    { code: "B04.06", name: "Schmutzwasserleitung" },
    { code: "B04.07", name: "Regenwasserleitung" },
    { code: "B04.08", name: "Gasleitung" },
    { code: "B05.01", name: "Fällung, Rodung, Umpflanzung" },
    { code: "B05.02", name: "Nicht kontaminierter Rückbau" },
    { code: "B05.03", name: "Kontaminierter Rückbau" }, */
  { code: "B06.01", name: "Nicht kontaminierter Aushub" },
  { code: "B06.02", name: "Kontaminierter Aushub" },
  { code: "B06.03", name: "Böschungssicherung" },
  { code: "B06.04", name: "Baugrubenabschluss" },
  { code: "B06.05", name: "Materialeinbau" },
  { code: "B06.06", name: "Wasserhaltung" },
  { code: "B07.01", name: "Verbesserung Baugrund" },
  { code: "B07.02", name: "Pfählung" },
  /*   { code: "B07.03", name: "Unterfangung Bauwerk" },
    { code: "B07.04", name: "Sicherung Bauwerk" },
    { code: "B08.01", name: "Fassadengerüst" },
    { code: "B08.02", name: "Arbeitsgerüst" },
    { code: "B08.03", name: "Notdach" },
    { code: "B08.04", name: "Schutzgerüst" },
    { code: "B09.01", name: "Bauliche Anpassungen angrenzendes Bauwerk" },
    { code: "B09.02", name: "Unterfangung, Sicherung angrenzendes Bauwerk" },
    { code: "B09.03", name: "Verkehrsanlage ausserhalb Grundstück" }, */
  { code: "C01.01", name: "Unterbau Fundament und Bodenplatte" },
  { code: "C01.02", name: "Fundament" },
  { code: "C01.03", name: "Bodenplatte" },
  { code: "C01.04", name: "Erdverbundene Treppe, Rampe" },
  { code: "C01.05", name: "Erdverbundenes Podest" },
  { code: "C02.01", name: "Aussenwandkonstruktion" },
  { code: "C02.02", name: "Innenwandkonstruktion" },
  { code: "C03.01", name: "Aussenstütze" },
  { code: "C03.02", name: "Innenstütze" },
  { code: "C04.01", name: "Geschossdecke" },
  { code: "C04.02", name: "Innen liegende Treppe, Rampe" },
  { code: "C04.03", name: "Innen liegende Podeste" },
  { code: "C04.04", name: "Konstruktion Flachdach" },
  { code: "C04.05", name: "Konstruktion geneigtes Dach" },
  { code: "C04.06", name: "Aussen liegende Treppe, Rampe" },
  { code: "C04.07", name: "Aussen liegende Podeste" },
  { code: "C04.08", name: "Aussen liegende Konstruktion, Vordach" },
  { code: "C05.01", name: "Durchbruch, Schlitz zu Konstruktion" },
  { code: "C05.02", name: "Maschinensockel, Einlage" },
  /*  { code: "D01.01", name: "Anlage, Erzeugung Starkstrom" },
   { code: "D01.02", name: "Transformierung Starkstrom" },
   { code: "D01.03", name: "Speicherung Starkstrom" },
   { code: "D01.04", name: "Installation Starkstrom" },
   { code: "D01.05", name: "Verbraucher Starkstrom: Leuchten" },
   { code: "D01.06", name: "Verbraucher Starkstrom: Elektrogeräte" },
   { code: "D01.07", name: "Anlage, Erzeugung Schwachstrom" },
   { code: "D01.08", name: "Transformierung Schwachstrom" },
   { code: "D01.09", name: "Speicherung Schwachstrom" },
   { code: "D01.10", name: "Installation Schwachstrom" },
   { code: "D01.11", name: "Verbraucher Schwachstrom" },
   { code: "D02.01", name: "Managementebene" },
   { code: "D02.02", name: "Automationsebene" },
   { code: "D02.03", name: "Feldebene" },
   { code: "D02.04", name: "Raumautomation" },
   { code: "D02.05", name: "Automationsnetzwerk" },
   { code: "D02.06", name: "Schaltgerätekombination" },
   { code: "D02.07", name: "Systemintegration" },
   { code: "D03.01", name: "Einbruchmeldeanlage, Überfallmeldeanlage" },
   { code: "D03.02", name: "Zutrittskontrollanlage" },
   { code: "D03.03", name: "Videoüberwachungsanlage" },
   { code: "D03.04", name: "Schliessanlage" },
   { code: "D04.01", name: "Brandmeldeanlage" },
   { code: "D04.02", name: "Gaswarnanlage" },
   { code: "D04.03", name: "Nasslöschanlage" },
   { code: "D04.04", name: "Trockenlöschanlage" },
   { code: "D04.05", name: "Löschgerät" },
   { code: "D04.06", name: "Rauch-  und Wärmebehandlungsanlage" },
   { code: "D04.07", name: "Elektroakustische Lautsprecheranlage" },
   { code: "D05.01", name: "Wärmequelle, -senke, Brennstofflager" },
   { code: "D05.02", name: "Wärmeerzeugung" },
   { code: "D05.03", name: "Wärmespeicherung" },
   { code: "D05.04", name: "Wärmeverteilung" },
   { code: "D05.05", name: "Wärmeabgabe" },
   { code: "D06.01", name: "Kältequelle, -senke, Brennstofflager" },
   { code: "D06.02", name: "Kälteerzeugung" },
   { code: "D06.03", name: "Kältespeicherung" },
   { code: "D06.04", name: "Kälteverteilung" },
   { code: "D06.05", name: "Kälteabgabe" },
   { code: "D07.01", name: "Aussenluftversorgung, Fortluftführung" },
   { code: "D07.02", name: "Luftaufbereitung" },
   { code: "D07.03", name: "Luftwärmespeicherung" },
   { code: "D07.04", name: "Luftverteilung" },
   { code: "D07.05", name: "Luftabgabe" },
   { code: "D08.01", name: "Wasserversorgung" },
   { code: "D08.02", name: "Wasserbehandlung" },
   { code: "D08.03", name: "Wasserspeicher" },
   { code: "D08.04", name: "Wasserverteilung" },
   { code: "D08.05", name: "Wasser: Armatur, Apparat" },
   { code: "D08.06", name: "Wasser: Installationselement" },
   { code: "D09.01", name: "Abwasserentsorgung" },
   { code: "D09.02", name: "Abwasserbehandlung" },
   { code: "D09.03", name: "Abwasserspeicher" },
   { code: "D09.04", name: "Abwassersammlung" },
   { code: "D09.05", name: "Abwasser: Armatur, Apparat" },
   { code: "D10.01", name: "Gasversorgung" },
   { code: "D10.02", name: "Gasbehandlung" },
   { code: "D10.03", name: "Gasspeicherung" },
   { code: "D10.04", name: "Gasverteilung" },
   { code: "D10.05", name: "Gas: Armatur, Apparat" },
   { code: "D11.01", name: "Spezialmedien: Versorgung, Entsorgung" },
   { code: "D11.02", name: "Spezialmedien: Aufbereitung" },
   { code: "D11.03", name: "Spezialmedien: Speicherung" },
   { code: "D11.04", name: "Spezialmedien: Verteilung" },
   { code: "D11.05", name: "Spezialmedien: Armatur, Apparat" },
   { code: "D12.01", name: "Personenaufzug" },
   { code: "D12.02", name: "Lasten- und Serviceaufzug" },
   { code: "D12.03", name: "Spezialaufzug" },
   { code: "D12.04", name: "Fahrtreppe" },
   { code: "D12.05", name: "Fahrsteig" },
   { code: "D12.06", name: "Hebeeinrichtung, Verladestation" }, */
  { code: "E01.01", name: "Wandabdichtung unter Terrain" },
  { code: "E01.02", name: "Aussenwärmedämmung unter Terrain" },
  { code: "E01.03", name: "Schutzschicht unter Terrain" },
  { code: "E02.01", name: "Äussere Beschichtung" },
  { code: "E02.02", name: "Aussenwärmedämmsystem" },
  { code: "E02.03", name: "Fassadenbekleidung" },
  { code: "E02.04", name: "Systemfassade" },
  { code: "E02.05", name: "Fassadenbekleidung Untersicht" },
  { code: "E02.06", name: "Aussenliegende Absturzssicherung" },
  { code: "E03.01", name: "Fenster" },
  { code: "E03.02", name: "Aussentür" },
  { code: "E03.03", name: "Aussentor" },
  { code: "E03.04", name: "Sonnenschutz, Wetterschutz" },
  { code: "E03.05", name: "Absturzsicherung" },
  { code: "F01.01", name: "Dachabdichtung unter Terrain" },
  { code: "F01.02", name: "Bedachung Flachdach" },
  { code: "F01.03", name: "Bedachung geneigtes Dach" },
  { code: "F01.04", name: "Systemdach" },
  { code: "F02.01", name: "Element zu Flachdach" },
  { code: "F02.02", name: "Element zu geneigtem Dach" },
  { code: "F02.03", name: "Schutzanlage zu Dach" },
  { code: "G01.01", name: "Fest stehende Trennwand" },
  { code: "G01.02", name: "Bewegliche Trennwand" },
  { code: "G01.03", name: "Schachtfront" },
  { code: "G01.04", name: "Innenfenster" },
  { code: "G01.05", name: "Innentür" },
  { code: "G01.06", name: "Innentor" },
  { code: "G02.01", name: "Unterkonstruktion zu Bodenbelag" },
  { code: "G02.02", name: "Bodenbelag" },
  { code: "G03.01", name: "Unterkonstruktion zu Wandbekleidung" },
  { code: "G03.02", name: "Wandbekleidung" },
  { code: "G04.01", name: "Unterkonstruktion zu Deckenbekleidung" },
  { code: "G04.02", name: "Deckenbekleidung" },
  { code: "G05.01", name: "Einbauschrank, Regal, Ablage" },
  { code: "G05.02", name: "Einbauküche" },
  { code: "G05.03", name: "Innerer Fensterausbau" },
  { code: "G05.04", name: "Innerer Abschluss" },
  { code: "G05.05", name: "Absturz-, Anprallschutzeinrichtung" },
  { code: "G05.06", name: "Sonderbauteil" },
  { code: "G05.07", name: "Kleinbauteil, Schutzraumeinrichtung" },
  { code: "G06.01", name: "Durchbruch, Schlitz zu Ausbau" },
  { code: "G06.02", name: "Abschottung" },
  { code: "G06.03", name: "Reinigung" },
  { code: "G06.04", name: "Trocknung" },
  /*   { code: "H01.01", name: "Produktionsanlage: Versorgung, Entsorgung" },
    { code: "H01.02", name: "Produktionsanlage: Aufbereitung" },
    { code: "H01.03", name: "Produktionsanlage: Speicherung" },
    { code: "H01.04", name: "Produktionsanlage: Verteilung" },
    { code: "H01.05", name: "Produktionsanlage: Armatur, Apparat" },
    { code: "H02.01", name: "Laboranlage: Versorgung, Entsorgung" },
    { code: "H02.02", name: "Laboranlage: Aufbereitung" },
    { code: "H02.03", name: "Laboranlage: Speicherung" },
    { code: "H02.04", name: "Laboranlage: Verteilung" },
    { code: "H02.05", name: "Laboranlage: Armatur, Apparat" },
    { code: "H03.01", name: "Grossküche: Versorgung, Entsorgung" },
    { code: "H03.02", name: "Grossküche: Aufbereitung" },
    { code: "H03.03", name: "Grossküche: Lagerung" },
    { code: "H03.04", name: "Grossküche: Verteilung" },
    { code: "H03.05", name: "Grossküche: Armatur, Apparat" },
    { code: "H04.01", name: "Wäscherei-, Reinigungsanlage: Versorgung, Entsorgung" },
    { code: "H04.02", name: "Wäscherei-, Reinigungsanlage: Aufbereitung" },
    { code: "H04.03", name: "Wäscherei-, Reinigungsanlage: Speicherung" },
    { code: "H04.04", name: "Wäscherei-, Reinigungsanlage: Verteilung" },
    { code: "H04.05", name: "Wäscherei-, Reinigungsanlage: Armaturen, Apparat" },
    { code: "H05.01", name: "Gerät für Vitaldatenüberwachung" },
    { code: "H05.02", name: "Einrichtung für Diagnostik" },
    { code: "H05.03", name: "Gerät für Behandlung, Pflege" },
    { code: "H05.04", name: "Medizinisches Kälte- / Wärmegerät" },
    { code: "H05.04", name: "Medizinisches Kälte- / Wärmegerät" },
    { code: "H05.05", name: "Mess-, Analysetechnik" },
    { code: "H05.06", name: "Reinigung, Desinfektion, Sterilisation" },
    { code: "H05.06", name: "Reinigung, Desinfektion, Sterilisation" },
    { code: "H05.06", name: "Reinigung, Desinfektion, Sterilisation" },
    { code: "H05.07", name: "Medizinische Einrichtung, Ausstattung" },
    { code: "H05.08", name: "Medizinischer Beleuchtungskörper" },
    { code: "H05.09", name: "Medizinische Textilien" },
    { code: "H05.10", name: "Medizinisches Kleininventar" },
    { code: "H05.11", name: "Medizinisches Transportmittel" },
    { code: "H05.12", name: "Medizinisches Betriebsmittel" },
    { code: "H06.01", name: "Bildung, Kultur: Versorgung, Entsorgung" },
    { code: "H06.02", name: "Bildung, Kultur: Apparat" },
    { code: "H06.03", name: "Bildung, Kultur: Steuerung" },
    { code: "H06.04", name: "Bildung Kultur: Einbauten" },
    { code: "H07.01", name: "Sportanlage, Freizeitanlage: Versorgung, Entsorgung" },
    { code: "H07.02", name: "Sportanlage, Freizeitanlage: Apparat" },
    { code: "H07.03", name: "Sportanlage, Freizeitanlage: Steuerung" },
    { code: "H07.04", name: "Sportanlage, Freizeitanlage: Einbauten" },
    { code: "H08.01", name: "Erholungsanlage: Versorgung, Entsorgung" },
    { code: "H08.02", name: "Erholungsanlage: Apparat" },
    { code: "H08.03", name: "Erholungsanlage: Steuerung" },
    { code: "H08.04", name: "Erholungsanlage: Einbaute" },
    { code: "H09.01", name: "Nutzungsspezifische Anlage: Versorgung, Entsorgung" },
    { code: "H09.02", name: "Nutzungsspezifische Anlage: Aufbereitung" },
    { code: "H09.03", name: "Nutzungsspezifische Anlage: Speicherung, Lagerung" },
    { code: "H09.04", name: "Nutzungsspezifische Anlage: Verteilung" },
    { code: "H09.05", name: "Nutzungsspezifische Anlage: Armatur, Apparat" },
    { code: "H09.06", name: "Parkieranlage" },
    { code: "H09.07", name: "Materialtransportanlage" },
    { code: "H09.08", name: "Kühlzelle" },
    { code: "H09.09", name: "Lagereinrichtung" },
    { code: "I01.01", name: "Geländeanpassung" },
    { code: "I01.02", name: "Tief liegende Entwässerung" },
    { code: "I02.01", name: "Böschungsverbau" },
    { code: "I02.02", name: "Stützmauer" },
    { code: "I02.03", name: "Frei stehende Wand" },
    { code: "I02.04", name: "Treppe, Rampe" },
    { code: "I02.05", name: "Kleinbauwerk" },
    { code: "I02.06", name: "Unterirdisches Bauwerk" },
    { code: "I02.07", name: "Absturz-, Anprallschutzeinrichtungen für Umgebung" },
    { code: "I02.08", name: "Einfriedung" },
    { code: "I03.01", name: "Vegetationstragschicht" },
    { code: "I03.02", name: "Saatfläche" },
    { code: "I03.03", name: "Flächenbepflanzung, Hecke" },
    { code: "I03.04", name: "Vertikale Begrünung" },
    { code: "I03.05", name: "Einzelbepflanzung" },
    { code: "I03.06", name: "Einfassung, Abschluss Grünfläche" },
    { code: "I03.07", name: "Naturnahe Wasserfläche" },
    { code: "I03.08", name: "Ingenieurbiologische Massnahme" },
    { code: "I03.09", name: "Pflegemassnahme bis Übergabe" },
    { code: "I04.01", name: "Fundations-, Tragschicht" },
    { code: "I04.02", name: "Einfassung, Abschluss Hartfläche" },
    { code: "I04.03", name: "Deckschicht" },
    { code: "I04.04", name: "Bodenmarkierung" },
    { code: "I05.01", name: "Elektroanlage Starkstrom für Umgebung" },
    { code: "I05.02", name: "Elektroanlage Schwachstrom für Umgebung" },
    { code: "I05.03", name: "Wärmeanlage für Umgebung" },
    { code: "I05.04", name: "Kälteanlage für Umgebung" },
    { code: "I05.05", name: "Sanitäre Anlage für Umgebung" },
    { code: "I05.06", name: "Oberflächenentwässerung für Umgebung" },
    { code: "I05.07", name: "Transportanlage in Umgebung" },
    { code: "I05.08", name: "Perimeterschutz" },
    { code: "I06.01", name: "Mobile Ausstattung für Umgebung" },
    { code: "I06.02", name: "Fixierte Ausstattung für Umgebung" },
    { code: "I06.03", name: "Spiel-, Sportgerät für Umgebung" },
    { code: "I06.04", name: "Abfallentsorgungseinrichtung für Umgebung" },
    { code: "J01.01", name: "Allgemeines Mobiliar" },
    { code: "J01.02", name: "Nutzungsspezifisches Mobiliar" },
    { code: "J01.03", name: "Mobile Leuchte" },
    { code: "J01.04", name: "Signaletik" },
    { code: "J02.01", name: "Allgemeines Kleininventar" },
    { code: "J02.02", name: "Nutzungsspezifisches Kleininventar" },
    { code: "J02.03", name: "Mobiles Gerät" },
    { code: "J03.01", name: "Allgemeine Textilien" },
    { code: "J03.02", name: "Nutzungsspezifische Textilien" },
    { code: "J04.01", name: "Kunstobjekt" },
    { code: "J04.02", name: "Künstlerisch gestaltetes Bauteil" }, */
];
